###############################################################################
#        NETBIRD SELF-HOSTED CONFIGURATION – AUTHENTIK-SPECIFIC EXAMPLE       #
#             Copy this file to setup.env and adjust the values.              #
###############################################################################

# -----------------------------------------------------------------------------
# Deployment mode
# -----------------------------------------------------------------------------
# - standalone           → NetBird terminates TLS itself (LetsEncrypt / certs)
# - proxy_docker         → reverse proxy in Docker (managed outside this compose)
# - proxy_external       → reverse proxy on another host/VM, NetBird exposes HTTP ports
# - proxy_docker_caddy   → reverse proxy (Caddy) included in this compose, Caddyfile is generated
NETBIRD_DEPLOYMENT_MODE="proxy_docker_caddy"

# Generic Docker network name used by your reverse proxy in Docker
# (proxy_docker / proxy_docker_caddy)
NETBIRD_REVERSE_PROXY_NETWORK="reverse_proxy_net"

# -----------------------------------------------------------------------------
# Image tags (optional; "latest" will be used by base.setup.env if empty)
# -----------------------------------------------------------------------------
NETBIRD_DASHBOARD_TAG=""
NETBIRD_SIGNAL_TAG=""
NETBIRD_MANAGEMENT_TAG=""
COTURN_TAG=""
NETBIRD_RELAY_TAG=""

# -----------------------------------------------------------------------------
# Domains
# -----------------------------------------------------------------------------
# Public dashboard domain, e.g. netbird.example.com
NETBIRD_DOMAIN=""

# TURN server domain, e.g. turn.example.com
# If not specified it will default to NETBIRD_DOMAIN
NETBIRD_TURN_DOMAIN=""

# TURN server public IP address (used for peers behind different NATs)
# If empty, the configure.sh script will try to auto-detect it.
NETBIRD_TURN_EXTERNAL_IP=""

# -----------------------------------------------------------------------------
# OIDC – AUTHENTIK CONFIGURATION (ACTIVE)
# -----------------------------------------------------------------------------
# This file is tailored for Authentik. All OIDC settings below follow the
# pattern recommended in the NetBird + Authentik documentation.
#
# Assumptions:
#   Authentik host:      https://auth.example.com
#   NetBird application: https://auth.example.com/application/o/netbird/
#   Well-known config:   https://auth.example.com/application/o/netbird/.well-known/openid-configuration

# Use Authentik as management IdP
NETBIRD_MGMT_IDP="authentik"

# 1) OIDC discovery endpoint from Authentik (NetBird application well-known URL)
#    Replace <AUTH_HOST> with your Authentik hostname.
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT="https://auth.example.com/application/o/netbird/.well-known/openid-configuration"

# 2) Client ID and secret from your Authentik NetBird provider
NETBIRD_AUTH_CLIENT_ID="netbird-client"

# 3) Scopes used by NetBird via Authentik
NETBIRD_AUTH_SUPPORTED_SCOPES="openid profile email offline_access api"

# 4) Audience – with Authentik it is often convenient to use the client ID
NETBIRD_AUTH_AUDIENCE="$NETBIRD_AUTH_CLIENT_ID"

# 5) Keep Auth0 mode disabled for Authentik
NETBIRD_USE_AUTH0="false"

# 6) Redirect URIs – paths on the NetBird dashboard domain:
#    → NetBird will use:
#         https://$NETBIRD_DOMAIN$NETBIRD_AUTH_REDIRECT_URI
#         https://$NETBIRD_DOMAIN$NETBIRD_AUTH_SILENT_REDIRECT_URI
NETBIRD_AUTH_REDIRECT_URI="/auth"
NETBIRD_AUTH_SILENT_REDIRECT_URI="/silent-auth"

# 7) Device Authorization Flow (optional, usually same client/audience)
NETBIRD_AUTH_DEVICE_AUTH_PROVIDER="none"
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID="$NETBIRD_AUTH_CLIENT_ID"
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE="$NETBIRD_AUTH_CLIENT_ID"
NETBIRD_AUTH_DEVICE_AUTH_SCOPE="openid"
NETBIRD_AUTH_DEVICE_AUTH_USE_ID_TOKEN=false

# 8) PKCE redirect ports for the CLI
NETBIRD_AUTH_PKCE_REDIRECT_URL_PORTS="53000"

# Optional: custom claim for user ID (instead of 'sub') – usually not needed
# NETBIRD_AUTH_USER_ID_CLAIM=""

# -----------------------------------------------------------------------------
# IDP MANAGEMENT – AUTHENTIK
# -----------------------------------------------------------------------------
# For Authentik, the management client usually reuses the same client as above,
# but you can also create a dedicated service client if you prefer.

# Management API client for Authentik (defaults to NETBIRD_AUTH_CLIENT_ID)
NETBIRD_IDP_MGMT_CLIENT_ID="$NETBIRD_AUTH_CLIENT_ID"

# Optional: service account used by NetBird to manage users/groups via Authentik
NETBIRD_IDP_MGMT_EXTRA_USERNAME="Netbird"
NETBIRD_IDP_MGMT_EXTRA_PASSWORD=""

# -----------------------------------------------------------------------------
# LetsEncrypt / Reverse Proxy
# -----------------------------------------------------------------------------
# For proxy modes, LetsEncrypt inside NetBird is typically disabled and TLS
# is terminated by the reverse proxy (e.g. Caddy).
NETBIRD_DISABLE_LETSENCRYPT=true

# External TLS port exposed by your reverse proxy (most commonly 443)
NETBIRD_EXTERNAL_TLS_PORT=443

# E-mail used for LetsEncrypt when NETBIRD_DISABLE_LETSENCRYPT=false
NETBIRD_LETSENCRYPT_EMAIL=""

# Internal service ports used when running behind a reverse proxy
# (proxy_docker / proxy_external / proxy_docker_caddy).
# These are the ports the NetBird containers listen on inside Docker.
# Caddy (or your reverse proxy) will forward to these.
NETBIRD_DASHBOARD_INTERNAL_PORT=80
NETBIRD_SIGNAL_INTERNAL_PORT=10000
NETBIRD_RELAY_INTERNAL_PORT=33080
NETBIRD_MGMT_INTERNAL_PORT=33073

# -----------------------------------------------------------------------------
# Data paths (bind mounts)
# -----------------------------------------------------------------------------
# Base path for bind mounted data (management, signal, letsencrypt, postgres)
# Default is ./artifacts/data (created automatically by Docker on first start).
# You usually do NOT need to change this.
# DATA_PATH="./artifacts/data"

# -----------------------------------------------------------------------------
# Extra settings
# -----------------------------------------------------------------------------
# Disable anonymous metrics collection, see NetBird docs for details.
NETBIRD_DISABLE_ANONYMOUS_METRICS=false
# DNS DOMAIN configures the domain name used for peer resolution.
NETBIRD_MGMT_DNS_DOMAIN=netbird.selfhosted
# Disable default all-to-all policy for new accounts
NETBIRD_MGMT_DISABLE_DEFAULT_POLICY=false

# -----------------------------------------------------------------------------
# Relay settings
# -----------------------------------------------------------------------------
# Relay server domain. If not set it will assume NETBIRD_DOMAIN
NETBIRD_RELAY_DOMAIN=""
# Relay server connection port. If none is supplied it will default to 33080
# In proxy modes this will usually be mapped from NETBIRD_RELAY_INTERNAL_PORT.
NETBIRD_RELAY_PORT=""
# Management API connecting port. If none is supplied it will default to 33073
NETBIRD_MGMT_API_PORT=""
# Signal service connecting port. If none is supplied it will default to 10000
NETBIRD_SIGNAL_PORT=""

# -----------------------------------------------------------------------------
# Store config (database)
# -----------------------------------------------------------------------------
# Valid values: "sqlite", "postgres"
NETBIRD_STORE_CONFIG_ENGINE="postgres"

# If NETBIRD_STORE_CONFIG_ENGINE=postgres:
#   - NETBIRD_USE_INTERNAL_POSTGRES=true (default):
#       → internal Postgres container (service "postgres") will be started
#       → configure.sh will auto-generate NETBIRD_STORE_ENGINE_POSTGRES_DSN
#         pointing to host=postgres (internal service).
#   - NETBIRD_USE_INTERNAL_POSTGRES=false:
#       → NO internal Postgres container
#       → you MUST set NETBIRD_STORE_ENGINE_POSTGRES_DSN to an external DB.
NETBIRD_USE_INTERNAL_POSTGRES=true

# When using internal Postgres, you can customize these (optional):
# If NETBIRD_POSTGRES_PASSWORD is empty, configure.sh will automatically
# generate a strong random password and use it for the internal Postgres service.
NETBIRD_POSTGRES_DB="netbird"
NETBIRD_POSTGRES_USER="netbird"
NETBIRD_POSTGRES_PASSWORD=""

# When using external Postgres (NETBIRD_USE_INTERNAL_POSTGRES=false), set DSN here:
# Example:
# NETBIRD_STORE_ENGINE_POSTGRES_DSN="host=db.example.com user=netbird password=secret dbname=netbird port=5432 sslmode=disable"
NETBIRD_STORE_ENGINE_POSTGRES_DSN=""