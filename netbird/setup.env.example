## Example file. You can copy this file to setup.env and update its values.

# -----------------------------------------------------------------------------
# Deployment mode
# -----------------------------------------------------------------------------
# - standalone           → NetBird terminates TLS itself (LetsEncrypt / certs)
# - proxy_docker         → reverse proxy in Docker (managed outside this compose)
# - proxy_external       → reverse proxy on another host/VM, NetBird exposes HTTP ports
# - proxy_docker_caddy   → reverse proxy (Caddy) included in this compose, Caddyfile is generated
NETBIRD_DEPLOYMENT_MODE="standalone"

# Generic Docker network name used by your reverse proxy in Docker
# (proxy_docker / proxy_docker_caddy)
NETBIRD_REVERSE_PROXY_NETWORK="reverse_proxy_net"

# -----------------------------------------------------------------------------
# Image tags
# -----------------------------------------------------------------------------
NETBIRD_DASHBOARD_TAG=""
NETBIRD_SIGNAL_TAG=""
NETBIRD_MANAGEMENT_TAG=""
COTURN_TAG=""
NETBIRD_RELAY_TAG=""

# -----------------------------------------------------------------------------
# Domains
# -----------------------------------------------------------------------------
# Dashboard domain, e.g. app.mydomain.com
NETBIRD_DOMAIN=""

# TURN server domain, e.g. turn.mydomain.com
# If not specified it will default to NETBIRD_DOMAIN
NETBIRD_TURN_DOMAIN=""

# TURN server public IP address (used for peers behind different NATs)
NETBIRD_TURN_EXTERNAL_IP=""

# -----------------------------------------------------------------------------
# OIDC – GENERAL SETTINGS (for any IdP)
# -----------------------------------------------------------------------------
# Configuration endpoint of your OIDC provider (well-known URL)
# Example (generic): https://idp.example.com/.well-known/openid-configuration
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT=""

# Audience to request from the IdP
NETBIRD_AUTH_AUDIENCE=""

# OIDC client ID for NetBird dashboard / clients
NETBIRD_AUTH_CLIENT_ID=""

# OIDC client secret (required e.g. by Google Workspace; may be empty for some IdPs)
NETBIRD_AUTH_CLIENT_SECRET=""

# Scopes requested from the IdP
# For most providers: "openid profile email"
NETBIRD_AUTH_SUPPORTED_SCOPES=""

# If your IdP uses a custom claim for user ID (instead of 'sub'), set it here
# NETBIRD_AUTH_USER_ID_CLAIM=""

# Indicates whether to use Auth0 legacy mode (true/false)
NETBIRD_USE_AUTH0="false"

# If your IdP does not support fragments in redirect URIs, you can set
# custom redirect and silent redirect paths here. They will be combined with NETBIRD_DOMAIN.
# Examples:
# NETBIRD_AUTH_REDIRECT_URI="/peers"
# NETBIRD_AUTH_SILENT_REDIRECT_URI="/add-peers"
NETBIRD_AUTH_REDIRECT_URI=""
NETBIRD_AUTH_SILENT_REDIRECT_URI=""

# Updates the preference to use ID tokens instead of access tokens on the dashboard.
# Some IdPs (Okta, Gitlab) work better with idToken.
# NETBIRD_TOKEN_SOURCE="idToken"

# -----------------------------------------------------------------------------
# OIDC – DEVICE AUTHORIZATION FLOW (optional)
# -----------------------------------------------------------------------------
NETBIRD_AUTH_DEVICE_AUTH_PROVIDER="none"
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID=""
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE=$NETBIRD_AUTH_AUDIENCE
NETBIRD_AUTH_DEVICE_AUTH_SCOPE="openid"
NETBIRD_AUTH_DEVICE_AUTH_USE_ID_TOKEN=false

# -----------------------------------------------------------------------------
# OIDC – PKCE AUTHORIZATION FLOW (NetBird CLI)
# -----------------------------------------------------------------------------
# Comma separated port numbers. If already in use, PKCE flow will choose
# an available port from the list as an alternative.
# Example: 53000,54000
NETBIRD_AUTH_PKCE_REDIRECT_URL_PORTS="53000"

# -----------------------------------------------------------------------------
# IDP MANAGEMENT – GENERAL
# -----------------------------------------------------------------------------
# Possible values: "none", "auth0", "azure", "keycloak", "zitadel", "authentik", ...
NETBIRD_MGMT_IDP="none"

# Some IdPs require separate client credentials for management APIs.
NETBIRD_IDP_MGMT_CLIENT_ID=$NETBIRD_AUTH_CLIENT_ID
NETBIRD_IDP_MGMT_CLIENT_SECRET=""

# Additional variables for specific IdPs can be set via NETBIRD_IDP_MGMT_EXTRA_*
# and will be converted to JSON and passed to NetBird.
# Example:
# NETBIRD_IDP_MGMT_EXTRA_ADMIN_ENDPOINT="https://<YOUR_KEYCLOAK>/admin/realms/netbird"
# NETBIRD_MGMT_IDP_SIGNKEY_REFRESH=false

# -----------------------------------------------------------------------------
# AUTHENTIK PRESET (RECOMMENDED DEFAULTS FOR AUTHENTIK)
# -----------------------------------------------------------------------------
# If you are using Authentik as IdP, you normally want to set ALL of the
# following variables. This matches NetBird's Authentik documentation.
#
# 1. Set NETBIRD_MGMT_IDP="authentik"
# 2. Set NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT to the Authentik
#    application well-known URL (for your NetBird OIDC provider).
# 3. Use the same client ID for NetBird dashboard, device auth and management.

# Example Authentik URLs (adjust <YOUR_AUTHENTIK_HOST_AND_PORT>):
#   Authentik host:      https://auth.example.com
#   NetBird application: https://auth.example.com/application/o/netbird/
#   Well-known config:   https://auth.example.com/application/o/netbird/.well-known/openid-configuration

# Authentik OIDC configuration endpoint for the NetBird application
# Example:
# NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT="https://auth.example.com/application/o/netbird/.well-known/openid-configuration"
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT=""

# Do NOT use Auth0 compatibility mode with Authentik
NETBIRD_USE_AUTH0=false

# Provider client ID from Authentik (for the NetBird OIDC provider)
NETBIRD_AUTH_CLIENT_ID=""

# Scopes recommended for Authentik
NETBIRD_AUTH_SUPPORTED_SCOPES="openid profile email offline_access api"

# For Authentik it is often convenient to use the same value for audience and client_id
NETBIRD_AUTH_AUDIENCE="$NETBIRD_AUTH_CLIENT_ID"

# Device authorization client settings (usually same as NETBIRD_AUTH_CLIENT_ID / _AUDIENCE)
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID="$NETBIRD_AUTH_CLIENT_ID"
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE="$NETBIRD_AUTH_CLIENT_ID"

# Redirect paths used by NetBird dashboard (these will be combined with NETBIRD_DOMAIN)
# Example:
#   https://netbird.example.com/auth
#   https://netbird.example.com/silent-auth
NETBIRD_AUTH_REDIRECT_URI="/auth"
NETBIRD_AUTH_SILENT_REDIRECT_URI="/silent-auth"

# Management IdP type for Authentik
NETBIRD_MGMT_IDP="authentik"

# Management API client ID for Authentik (usually same as provider client ID)
NETBIRD_IDP_MGMT_CLIENT_ID="$NETBIRD_AUTH_CLIENT_ID"

# Optional: extra configuration for Authentik management, passed as JSON
# via NETBIRD_IDP_MGMT_EXTRA_... variables. Common pattern:
# - a service account (username/password) used to manage users/groups via Authentik.
NETBIRD_IDP_MGMT_EXTRA_USERNAME="Netbird"
NETBIRD_IDP_MGMT_EXTRA_PASSWORD=""

# If your Authentik setup uses a different admin endpoint, you can add:
# NETBIRD_IDP_MGMT_EXTRA_ADMIN_ENDPOINT="https://<YOUR_AUTHENTIK_HOST_AND_PORT>/api/v3/"

# -----------------------------------------------------------------------------
# LetsEncrypt / Reverse Proxy
# -----------------------------------------------------------------------------
# If true, LetsEncrypt support inside NetBird is disabled and you MUST use
# a reverse proxy terminating TLS in front of NetBird.
NETBIRD_DISABLE_LETSENCRYPT=false

# External TLS port exposed by your reverse proxy (most commonly 443)
NETBIRD_EXTERNAL_TLS_PORT=443

# E-mail used for LetsEncrypt when NETBIRD_DISABLE_LETSENCRYPT=false
NETBIRD_LETSENCRYPT_EMAIL=""

# -----------------------------------------------------------------------------
# Data paths (bind mounts)
# -----------------------------------------------------------------------------
# Base path for bind mounted data (management, signal, letsencrypt, postgres)
# Default is ./artifacts/data
# You usually do NOT need to change this.
# DATA_PATH="./artifacts/data"

# -----------------------------------------------------------------------------
# Extra settings
# -----------------------------------------------------------------------------
NETBIRD_DISABLE_ANONYMOUS_METRICS=false
NETBIRD_MGMT_DNS_DOMAIN=netbird.selfhosted
NETBIRD_MGMT_DISABLE_DEFAULT_POLICY=false

# -----------------------------------------------------------------------------
# Relay settings
# -----------------------------------------------------------------------------
NETBIRD_RELAY_DOMAIN=""
NETBIRD_RELAY_PORT=""
NETBIRD_MGMT_API_PORT=""
NETBIRD_SIGNAL_PORT=""

# -----------------------------------------------------------------------------
# Store config (database)
# -----------------------------------------------------------------------------
# Valid values: "sqlite", "postgres"
NETBIRD_STORE_CONFIG_ENGINE="sqlite"

# If NETBIRD_STORE_CONFIG_ENGINE=postgres:
#   - NETBIRD_USE_INTERNAL_POSTGRES=true (default):
#       → internal Postgres container (service "postgres") will be started
#       → configure.sh will auto-generate NETBIRD_STORE_ENGINE_POSTGRES_DSN
#         pointing to host=postgres (internal service).
#   - NETBIRD_USE_INTERNAL_POSTGRES=false:
#       → NO internal Postgres container
#       → you MUST set NETBIRD_STORE_ENGINE_POSTGRES_DSN to an external DB.
NETBIRD_USE_INTERNAL_POSTGRES=true

# When using internal Postgres, you can customize these (optional):
# If NETBIRD_POSTGRES_PASSWORD is empty, configure.sh will automatically
# generate a strong random password and use it for the internal Postgres service.
NETBIRD_POSTGRES_DB="netbird"
NETBIRD_POSTGRES_USER="netbird"
NETBIRD_POSTGRES_PASSWORD=""

# When using external Postgres (NETBIRD_USE_INTERNAL_POSTGRES=false), set DSN here:
# Example:
# NETBIRD_STORE_ENGINE_POSTGRES_DSN="host=db.example.com user=netbird password=secret dbname=netbird port=5432 sslmode=disable"
NETBIRD_STORE_ENGINE_POSTGRES_DSN=""