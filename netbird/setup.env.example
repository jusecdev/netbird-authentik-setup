## Example file. You can copy this file to setup.env and update its values.

# -----------------------------------------------------------------------------
# Deployment mode
# -----------------------------------------------------------------------------
# - standalone           → NetBird terminates TLS itself (LetsEncrypt / certs)
# - proxy_docker         → reverse proxy in Docker (managed outside this compose)
# - proxy_external       → reverse proxy on another host/VM, NetBird exposes HTTP ports
# - proxy_docker_caddy   → reverse proxy (Caddy) included in this compose, Caddyfile is generated
NETBIRD_DEPLOYMENT_MODE="standalone"

# Generic Docker network name used by your reverse proxy in Docker
# (proxy_docker / proxy_docker_caddy)
NETBIRD_REVERSE_PROXY_NETWORK="reverse_proxy_net"

# -----------------------------------------------------------------------------
# Image tags
# -----------------------------------------------------------------------------
NETBIRD_DASHBOARD_TAG=""
NETBIRD_SIGNAL_TAG=""
NETBIRD_MANAGEMENT_TAG=""
COTURN_TAG=""
NETBIRD_RELAY_TAG=""

# -----------------------------------------------------------------------------
# Domains
# -----------------------------------------------------------------------------
# Dashboard domain, e.g. app.mydomain.com
NETBIRD_DOMAIN=""

# TURN server domain, e.g. turn.mydomain.com
# If not specified it will default to NETBIRD_DOMAIN
NETBIRD_TURN_DOMAIN=""

# TURN server public IP address (used for peers behind different NATs)
NETBIRD_TURN_EXTERNAL_IP=""

# -------------------------------------------
# OIDC
#  e.g., https://example.eu.auth0.com/.well-known/openid-configuration
# -------------------------------------------
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT=""
# The default setting is to transmit the audience to the IDP during authorization. However,
# if your IDP does not have this capability, you can turn this off by setting it to false.
#NETBIRD_DASH_AUTH_USE_AUDIENCE=false
NETBIRD_AUTH_AUDIENCE=""
# e.g. netbird-client
NETBIRD_AUTH_CLIENT_ID=""
# indicates the scopes that will be requested to the IDP
NETBIRD_AUTH_SUPPORTED_SCOPES=""
# NETBIRD_AUTH_CLIENT_SECRET is required only by Google workspace.
# NETBIRD_AUTH_CLIENT_SECRET=""
# if you want to use a custom claim for the user ID instead of 'sub', set it here
# NETBIRD_AUTH_USER_ID_CLAIM=""
# indicates whether to use Auth0 or not: true or false
NETBIRD_USE_AUTH0="false"
# if your IDP provider doesn't support fragmented URIs, configure custom
# redirect and silent redirect URIs, these will be concatenated into your NETBIRD_DOMAIN domain.
# NETBIRD_AUTH_REDIRECT_URI="/peers"
# NETBIRD_AUTH_SILENT_REDIRECT_URI="/add-peers"
# Updates the preference to use id tokens instead of access token on dashboard
# Okta and Gitlab IDPs can benefit from this
# NETBIRD_TOKEN_SOURCE="idToken"

# -----------------------------------------------------------------------------
# OIDC – DEVICE AUTHORIZATION FLOW (optional)
# -----------------------------------------------------------------------------
NETBIRD_AUTH_DEVICE_AUTH_PROVIDER="none"
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID=""
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE=$NETBIRD_AUTH_AUDIENCE
NETBIRD_AUTH_DEVICE_AUTH_SCOPE="openid"
NETBIRD_AUTH_DEVICE_AUTH_USE_ID_TOKEN=false

# -----------------------------------------------------------------------------
# OIDC – PKCE AUTHORIZATION FLOW (NetBird CLI)
# -----------------------------------------------------------------------------
# Comma separated port numbers. If already in use, PKCE flow will choose
# an available port from the list as an alternative.
# Example: 53000,54000
NETBIRD_AUTH_PKCE_REDIRECT_URL_PORTS="53000"

# -----------------------------------------------------------------------------
# IDP MANAGEMENT – GENERAL
# -----------------------------------------------------------------------------
# Possible values: "none", "auth0", "azure", "keycloak", "zitadel", "authentik", ...
#NETBIRD_MGMT_IDP="none"

# Some IdPs require separate client credentials for management APIs.
#NETBIRD_IDP_MGMT_CLIENT_ID=$NETBIRD_AUTH_CLIENT_ID
#NETBIRD_IDP_MGMT_CLIENT_SECRET=""

# Additional variables for specific IdPs can be set via NETBIRD_IDP_MGMT_EXTRA_*
# and will be converted to JSON and passed to NetBird.
# Example:
# NETBIRD_IDP_MGMT_EXTRA_ADMIN_ENDPOINT="https://<YOUR_KEYCLOAK>/admin/realms/netbird"
# NETBIRD_MGMT_IDP_SIGNKEY_REFRESH=false

# -----------------------------------------------------------------------------
# AUTHENTIK PRESET
# -----------------------------------------------------------------------------
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT="https://<YOUR_AUTHENTIK_HOST_AND_PORT>/application/o/netbird/.well-known/openid-configuration"
NETBIRD_USE_AUTH0=false
NETBIRD_AUTH_CLIENT_ID="<PROVIDER_CLIENT_ID>"
NETBIRD_AUTH_SUPPORTED_SCOPES="openid profile email offline_access api"
NETBIRD_AUTH_AUDIENCE=$NETBIRD_AUTH_CLIENT_ID
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID=$NETBIRD_AUTH_CLIENT_ID
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE=$NETBIRD_AUTH_CLIENT_ID
NETBIRD_AUTH_REDIRECT_URI="/auth"
NETBIRD_AUTH_SILENT_REDIRECT_URI="/silent-auth"

NETBIRD_MGMT_IDP="authentik"
NETBIRD_IDP_MGMT_CLIENT_ID=$NETBIRD_AUTH_CLIENT_ID
NETBIRD_IDP_MGMT_EXTRA_USERNAME="Netbird"
NETBIRD_IDP_MGMT_EXTRA_PASSWORD="<SERVICE_ACCOUNT_PASSWORD>"

# needs disabling due to issue with IdP. Learn more [here](https://github.com/netbirdio/netbird/issues/3654)
NETBIRD_AUTH_PKCE_DISABLE_PROMPT_LOGIN=true

# -----------------------------------------------------------------------------
# LetsEncrypt / Reverse Proxy
# -----------------------------------------------------------------------------
# If true, LetsEncrypt support inside NetBird is disabled and you MUST use
# a reverse proxy terminating TLS in front of NetBird.
NETBIRD_DISABLE_LETSENCRYPT=false

# External TLS port exposed by your reverse proxy (most commonly 443)
NETBIRD_EXTERNAL_TLS_PORT=443

# E-mail used for LetsEncrypt when NETBIRD_DISABLE_LETSENCRYPT=false
NETBIRD_LETSENCRYPT_EMAIL=""

# -----------------------------------------------------------------------------
# Data paths (bind mounts)
# -----------------------------------------------------------------------------
# Base path for bind mounted data (management, signal, letsencrypt, postgres)
# Default is ./artifacts/data
# You usually do NOT need to change this.
# DATA_PATH="./artifacts/data"

# -----------------------------------------------------------------------------
# Extra settings
# -----------------------------------------------------------------------------
NETBIRD_DISABLE_ANONYMOUS_METRICS=false
NETBIRD_MGMT_DNS_DOMAIN=netbird.selfhosted
NETBIRD_MGMT_DISABLE_DEFAULT_POLICY=false

# -----------------------------------------------------------------------------
# Relay settings
# -----------------------------------------------------------------------------
NETBIRD_RELAY_DOMAIN=""
NETBIRD_RELAY_PORT=""
NETBIRD_MGMT_API_PORT=""
NETBIRD_SIGNAL_PORT=""

# -----------------------------------------------------------------------------
# Store config (database)
# -----------------------------------------------------------------------------
# Valid values: "sqlite", "postgres"
NETBIRD_STORE_CONFIG_ENGINE="sqlite"

# If NETBIRD_STORE_CONFIG_ENGINE=postgres:
#   - NETBIRD_USE_INTERNAL_POSTGRES=true (default):
#       → internal Postgres container (service "postgres") will be started
#       → configure.sh will auto-generate NETBIRD_STORE_ENGINE_POSTGRES_DSN
#         pointing to host=postgres (internal service).
#   - NETBIRD_USE_INTERNAL_POSTGRES=false:
#       → NO internal Postgres container
#       → you MUST set NETBIRD_STORE_ENGINE_POSTGRES_DSN to an external DB.
NETBIRD_USE_INTERNAL_POSTGRES=true

# When using internal Postgres, you can customize these (optional):
# If NETBIRD_POSTGRES_PASSWORD is empty, configure.sh will automatically
# generate a strong random password and use it for the internal Postgres service.
NETBIRD_POSTGRES_DB="netbird"
NETBIRD_POSTGRES_USER="netbird"
NETBIRD_POSTGRES_PASSWORD=""

# When using external Postgres (NETBIRD_USE_INTERNAL_POSTGRES=false), set DSN here:
# Example:
# NETBIRD_STORE_ENGINE_POSTGRES_DSN="host=db.example.com user=netbird password=secret dbname=netbird port=5432 sslmode=disable"
NETBIRD_STORE_ENGINE_POSTGRES_DSN=""